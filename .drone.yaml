kind: pipeline
type: kubernetes
name: Build recruitunit

steps:
  - name: build recruitunit
    image: docker:dind
    privileged: true
#    settings:
#      registry: 'harbor-bitnami.default'
#      username: stewart
#      password: stJ0hnstuHARBOR #todo: replace with secret
#      dockerfile: ./Dockerfile
#      repo: 'harbor-bitnami.default/homelab/recruitunit'
#      debug: true
#      launch_debug: true
#      insecure: true
    volumes:
      - name: dockersock
        path: /var/run/docker.sock
    commands:
      - sleep 5 # give docker enough time to start
      - docker ps -a

#services:
#  - name: docker
#    image: docker:dind
#    privileged: true
#    volumes:
#      - name: temp-mount
#        path: /dist

volumes:
  - name: temp-mount
    temp: {}
  - name: dockersock
    host:
      path: /var/run/docker.sock